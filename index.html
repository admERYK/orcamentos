<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orçamento Jardinagem</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    h1 {
      color: yellow;
      text-align: center;
      margin: 1rem 0;
    }
    table {
      width: 95%;
      margin: auto;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    th, td {
      border: 1px solid yellow;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #111;
    }
    input[type="number"], input[type="text"] {
      width: 80px;
      background: #222;
      color: #fff;
      border: 1px solid yellow;
    }
    .buttons {
      text-align: center;
      margin-bottom: 1rem;
    }
    button {
      background: yellow;
      border: none;
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }
    #settingsPanel {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: #111;
      border: 1px solid yellow;
      padding: 10px;
      z-index: 999;
      display: none;
    }
    #profile-pic {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid yellow;
      cursor: pointer;
    }
    #profile-upload {
      display: none;
    }
  </style>
</head>
<body>
  <div id="profile-pic" onclick="document.getElementById('profile-upload').click()"></div>
  <input type="file" id="profile-upload" accept="image/*">

  <h1>Orçamento Jardinagem</h1>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>Selecione</th>
        <th>Serviço / Item</th>
        <th>Preço (R$)</th>
        <th>Quantidade</th>
        <th>Subtotal (R$)</th>
      </tr>
    </thead>
    <tbody id="itemsBody"></tbody>
  </table>

  <div class="buttons">
    <div>Total: R$ <span id="total">0.00</span></div>
    <label>Lucro (%): <input type="number" id="profit" value="0" onchange="updateTotal()">%</label>
    <div><button onclick="printOrcamento()">Imprimir orçamento</button> <button onclick="enviarWhatsApp()">Enviar para WhatsApp</button></div>
  </div>

  <button style="position: fixed; bottom: 20px; left: 20px;" onclick="toggleSettings()">Gerenciar Itens</button>
  <div id="settingsPanel">
    <div><strong>Adicionar/Editar Item</strong></div>
    <input type="text" id="itemNome" placeholder="Nome">
    <input type="number" id="itemPreco" placeholder="Preço">
    <input type="number" id="itemQtd" placeholder="Qtd">
    <button onclick="adicionarItem()">Adicionar</button>
    <div id="editList"></div>
  </div>

  <script>
    let itens = JSON.parse(localStorage.getItem('itens') || '[]');

    function salvarItens() {
      localStorage.setItem('itens', JSON.stringify(itens));
    }

    function renderTabela() {
      const body = document.getElementById('itemsBody');
      body.innerHTML = '';
      itens.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="checkbox" onchange="updateTotal()" data-i="${index}" checked></td>
          <td>${item.nome}</td>
          <td>${item.preco.toFixed(2)}</td>
          <td><input type="number" value="${item.qtd}" onchange="itens[${index}].qtd=this.value;salvarItens();renderTabela()"></td>
          <td>${(item.qtd * item.preco).toFixed(2)}</td>
        `;
        body.appendChild(row);
      });
      updateTotal();
    }

    function updateTotal() {
      let total = 0;
      document.querySelectorAll('#itemsBody input[type=checkbox]').forEach(cb => {
        const index = cb.dataset.i;
        if (cb.checked) {
          total += itens[index].preco * itens[index].qtd;
        }
      });
      const lucro = parseFloat(document.getElementById('profit').value) || 0;
      total += total * (lucro / 100);
      document.getElementById('total').textContent = total.toFixed(2);
    }

    function adicionarItem() {
      const nome = document.getElementById('itemNome').value;
      const preco = parseFloat(document.getElementById('itemPreco').value);
      const qtd = parseInt(document.getElementById('itemQtd').value);
      if (!nome || isNaN(preco) || isNaN(qtd)) return;
      itens.push({ nome, preco, qtd });
      salvarItens();
      renderTabela();
      renderEditList();
    }

    function toggleSettings() {
      const panel = document.getElementById('settingsPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      renderEditList();
    }

    function renderEditList() {
      const container = document.getElementById('editList');
      container.innerHTML = itens.map((item, i) =>
        `<div style="margin-top:5px;">
          ${item.nome} <button onclick="excluirItem(${i})">Excluir</button>
        </div>`
      ).join('');
    }

    function excluirItem(i) {
      itens.splice(i, 1);
      salvarItens();
      renderTabela();
      renderEditList();
    }

    function printOrcamento() {
      window.print();
    }

    function enviarWhatsApp() {
      let msg = 'Orçamento:\n';
      document.querySelectorAll('#itemsBody input[type=checkbox]').forEach(cb => {
        if (cb.checked) {
          const i = cb.dataset.i;
          const item = itens[i];
          msg += `- ${item.nome} (${item.qtd} x ${item.preco.toFixed(2)}) = R$ ${(item.qtd * item.preco).toFixed(2)}\n`;
        }
      });
      msg += `Total: R$ ${document.getElementById('total').textContent}`;
      const link = `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(link, '_blank');
    }

    function carregarFotoPerfil() {
      const foto = localStorage.getItem('fotoPerfil');
      if (foto) document.getElementById('profile-pic').style.backgroundImage = `url(${foto})`;
    }

    document.getElementById('profile-upload').addEventListener('change', e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        localStorage.setItem('fotoPerfil', reader.result);
        carregarFotoPerfil();
      };
      if (file) reader.readAsDataURL(file);
    });

    carregarFotoPerfil();
    renderTabela();
  </script>
</body>
</html>